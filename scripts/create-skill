#!/usr/bin/env bash
# Helper script to create a new Agent Skill template

set -e

# Check arguments
if [ $# -lt 2 ]; then
    echo "Usage: create-skill <skills-directory> <skill-name> [description]"
    echo ""
    echo "Example:"
    echo "  create-skill ~/skills-personal home-automation 'Control smart home devices'"
    echo "  create-skill ~/skills-personal meal-planning"
    echo ""
    exit 1
fi

SKILLS_DIR="$1"
SKILL_NAME="$2"
DESCRIPTION="${3:-A personal skill for ai-assist}"

# Validate skill name (lowercase, hyphens only, no consecutive hyphens)
if ! echo "$SKILL_NAME" | grep -qE '^[a-z0-9]([a-z0-9-]*[a-z0-9])?$'; then
    echo "Error: Skill name must be lowercase letters, numbers, and hyphens only"
    echo "       Cannot start/end with hyphen or contain consecutive hyphens"
    exit 1
fi

if echo "$SKILL_NAME" | grep -q -- '--'; then
    echo "Error: Skill name cannot contain consecutive hyphens"
    exit 1
fi

# Create skill directory
SKILL_DIR="$SKILLS_DIR/$SKILL_NAME"
if [ -d "$SKILL_DIR" ]; then
    echo "Error: Skill '$SKILL_NAME' already exists at $SKILL_DIR"
    exit 1
fi

echo "Creating skill '$SKILL_NAME' at $SKILL_DIR..."
mkdir -p "$SKILL_DIR"

# Create SKILL.md with template
cat > "$SKILL_DIR/SKILL.md" << EOF
---
name: $SKILL_NAME
description: $DESCRIPTION
license: MIT
compatibility: ai-assist
---

# $SKILL_NAME

$DESCRIPTION

## Instructions

You are an AI assistant with access to the following capabilities:

- **TODO**: Describe what this skill enables you to do
- **TODO**: List key capabilities or knowledge areas

## Guidelines

1. **TODO**: Add specific guidelines for using this skill
2. **TODO**: Mention any preferences or constraints
3. **TODO**: Include examples or patterns to follow

## Examples

### Example 1: Basic Usage

**User**: TODO - Add example user request

**Assistant**: TODO - Add example response

### Example 2: Advanced Usage

**User**: TODO - Add another example

**Assistant**: TODO - Add response

## References

- **TODO**: Add relevant links, documentation, or context
- **TODO**: Include any personal preferences or workflows

## Notes

- Created: $(date +%Y-%m-%d)
- For personal use with ai-assist
- Edit this file to customize the skill
EOF

# Create optional directories
mkdir -p "$SKILL_DIR/scripts"
mkdir -p "$SKILL_DIR/references"
mkdir -p "$SKILL_DIR/assets"

# Create README for convenience
cat > "$SKILL_DIR/README.md" << EOF
# $SKILL_NAME

$DESCRIPTION

## Installation

\`\`\`bash
ai-assist /interactive
/skill/install $SKILL_DIR@main
\`\`\`

## Structure

- \`SKILL.md\` - Main skill definition (YAML frontmatter + instructions)
- \`scripts/\` - Executable scripts the AI can use (if script execution enabled)
- \`references/\` - Text files, docs, examples for context
- \`assets/\` - Images, data files, other resources

## Editing

Edit \`SKILL.md\` to customize:
- Instructions and guidelines
- Examples and patterns
- Capabilities and knowledge

Changes take effect after reinstalling or reloading skills.
EOF

echo ""
echo "✅ Created skill '$SKILL_NAME'"
echo ""
echo "Next steps:"
echo "  1. Edit $SKILL_DIR/SKILL.md to customize your skill"
echo "  2. Install it: ai-assist /interactive"
echo "     /skill/install $SKILL_DIR@main"
echo ""
echo "Structure:"
echo "  $SKILL_DIR/"
echo "  ├── SKILL.md       # Main skill definition"
echo "  ├── README.md      # Usage instructions"
echo "  ├── scripts/       # Optional: executable scripts"
echo "  ├── references/    # Optional: context files"
echo "  └── assets/        # Optional: resources"
echo ""
